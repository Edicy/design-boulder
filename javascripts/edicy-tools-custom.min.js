!function(a){"use strict";var b={type:null,id:null},c=function(c){this.options=a.extend({},b,c),this._callbacks={}};c.prototype={get:function(){var a=arguments&&arguments[0]&&"string"==typeof arguments[0]?arguments[0]:null,b=a?arguments[1]?arguments[1]:null:arguments[0]||null;this.getUrl(),this.request({method:"GET",callf:"get",key:a,callbacks:b})},set:function(){var a=arguments&&arguments[0]&&"string"==typeof arguments[0]?arguments[0]:null,b=a?arguments[1]:arguments[0]||null,c=a?arguments[2]?arguments[2]:null:arguments[1]||null,d=this.wrapData(b,a);this.request({method:"string"==typeof arguments[0]?"PUT":"PATCH",callf:"set",data:d,key:a,callbacks:c})},reset:function(){var a=arguments&&arguments[0]&&"string"==typeof arguments[0]?arguments[0]:null,b=a?arguments[1]:arguments[0]||null,c=a?arguments[2]?arguments[2]:null:arguments[1]||null,d=this.wrapData(b,a);this.request({method:"PUT",callf:"reset",data:d,key:a,callbacks:c})},remove:function(a,b){this.request({method:"DELETE",callf:"remove",key:a,callbacks:b})},request:function(b){var c=this.getUrl(b.key),d={type:b.method,dataType:"json",contentType:"application/json",url:c,success:a.proxy(function(a){this.handleSuccess(a,b.callf,b.key,b.callbacks)},this),error:a.proxy(function(a){this.handleError(a,b.callf,b.key,b.callbacks)},this)};b.data&&(d.data=JSON.stringify(b.data)),a.ajax(d)},handleSuccess:function(a,b,c,d){var e=a?a.data||a:null;e&&c&&"get"===b&&(e=e[c]),d&&d.success&&d.success(e),this.trigger("success",e,{type:b,key:c})},handleError:function(a,b,c,d){var e=a.responseText?JSON.parse(a.responseText):null;d&&d.error&&d.error(e),this.trigger("error",e,{type:b,key:c})},getUrl:function(a){var b="/admin/api/";return b+=this.options.id?this.options.type+"s/"+this.options.id:this.options.type,b+=a?"/data/"+a:"",b+=".json"},wrapData:function(a,b){var c=null;return null!==a&&(c={},a instanceof Object?(c[this.getTypeWrapper(b)]={},"string"==typeof b?c[this.getTypeWrapper(b)]=a:c[this.getTypeWrapper(b)].data=a):c[this.getTypeWrapper(b)]=a),c},getTypeWrapper:function(a){return a?"value":this.options.type||!1},on:function(b,c){this._callbacks[b]||(this._callbacks[b]=a.Callbacks()),this._callbacks[b].add(c)},off:function(a,b){this._callbacks[a]&&(b?this._callbacks[a].remove(b):this._callbacks[a].empty())},trigger:function(a,b,c){this._callbacks[a]&&this._callbacks[a].fire(b,c)}},Edicy.CustomData=c}(Edicy.jQuery),function(){this.JST||(this.JST={}),this.JST["admin/templates/tools_bgpicker"]=function(obj){var __p=[];with(obj||{})__p.push('<div data-cid="',cid,'"></div>\n');return __p.join("")}}.call(this),function(a){"use strict";var b={preview:function(){},commit:function(){},picture:!0,color:!0,template:'<div class="edy-bgpicker-inner"><div class="edy-tb-tabs"><div class="edy-bgpicker-picture-btn"><button class="edy-btn edy-btn-blue" data-tab-id="picture">Picture</button></div><div class="edy-bgpicker-color-btn"><button class="edy-btn edy-btn-white" data-tab-id="color">Color</button></div></div><div class="edy-bgpicker-tab edy-bgpicker-droparea" data-tab-id="picture"><div class="edy-bgpicker-image"><div class="bg-picker-remove-image"></div></div><div class="edy-bgpicker-notification">Drag a new picture here from the files panel.</div></div><div class="edy-bgpicker-tab" data-tab-id="color"><div class="edy-bgpicker-color"></div></div></div>'},c=function(c,d){this.$el=a(c),this.options=a.extend({},b,d),this.init()};c.prototype={init:function(){this.backgroundColor=this.$el.data("bg-color"),this.backgroundImage=this.$el.data("bg-image"),this.initialBgColor=this.backgroundColor,this.initialBgImage=this.backgroundImage,this.makeModal(),this.$el.addClass("edy-bgpicker-toggle-button"),this.$el.on("click",a.proxy(this.handleBtnClick,this))},handleBtnClick:function(a){a.preventDefault(),this.modal.toggle()},handleBgColorReset:function(){var b=this.$modal.find(".colpick_current_color").css("background-color");a(this.options.backgroundShowArea).css("background-color",b),this.handleBgColorChange()},loadCurrentImage:function(){this.$modal.find(".edy-bgpicker-image").css("background-image",'url("'+this.backgroundImage+'")')},makeModal:function(){this.modal=new Edicy.PopoverView({parent:this.$el,arrow:"big",containerClass:"edy-bgpicker",body:this.options.template,events:{"click .edy-tb-tabs button":a.proxy(this.handleTabClick,this),"click .bg-picker-remove-image":a.proxy(this.handleRemoveImage,this),"draggable:dragenter .edy-bgpicker-droparea":a.proxy(this.handleDropenter,this),"draggable:dragleave .edy-bgpicker-droparea":a.proxy(this.handleDropleave,this),"draggable:drop .edy-bgpicker-droparea":a.proxy(this.handleDrop,this)}}).render(),this.modal.on("edicy:popover:closed",a.proxy(this.handlePopoverClose,this)),this.$modal=this.modal.$el,this.options.color&&(this.$modal.addClass("edy-bgpicker-handle-color"),this.colorpicker=new Edicy.ColorpickerView({showAlpha:this.options&&this.options.showAlpha}).render(),this.colorpicker.on({colorchange:a.proxy(this.handleBgColorChange,this)},this),this.$modal.find(".edy-bgpicker-color").append(this.colorpicker.el),this.colorpicker.setValue(this.backgroundColor),this.colorObj=this.colorpicker.getCurrentColorData(),this.initialColorObj=this.colorObj),this.options.picture&&(this.$modal.addClass("edy-bgpicker-handle-picture"),this.backgroundImage&&this.$modal.find(".edy-bgpicker-image").css("background-image",'url("'+this.backgroundImage+'")').addClass("active")),!this.options.picture&&this.options.color?(this.$modal.find('.edy-bgpicker-tab[data-tab-id="color"]').addClass("active"),this.$modal.find(".edy-bgpicker-color-btn button").removeClass("edy-btn-white").addClass("edy-btn-blue")):this.$modal.find('.edy-bgpicker-tab[data-tab-id="picture"]').addClass("active")},handlePopoverClose:function(){this.dontSaveNextClose?this.dontSaveNextClose=!1:this.callCommit()},handleBgColorChange:function(a,b,c){this.backgroundColor=a,this.colorObj=c,this.callPreview()},handleBgImageChange:function(){this.$modal.find(".edy-bgpicker-image").css("background-image",'url("'+this.backgroundImage+'")').addClass("active"),this.callPreview(),this.dontSaveNextClose=!0,setTimeout(a.proxy(function(){this.modal.show(),this.dontSaveNextClose=!1},this),0)},handleRemoveImage:function(){this.backgroundImage=null,this.$modal.find(".edy-bgpicker-image").css("background-image","").removeClass("active"),this.callPreview()},callPreview:function(){this.options.preview&&this.options.preview({image:this.backgroundImage,color:this.backgroundColor,colorData:this.colorObj})},callCommit:function(){(this.initialBgImage!==this.backgroundImage||this.initialBgColor!==this.backgroundColor)&&(this.options.commit&&this.options.commit({image:this.backgroundImage,color:this.backgroundColor,colorData:this.colorObj}),this.initialBgImage=this.backgroundImage,this.initialBgColor=this.backgroundColor)},callCancel:function(){this.dontSaveNextClose=!0,this.backgroundImage=this.initialBgImage,this.backgroundColor=this.initialBgColor,this.colorObj=this.initialColorObj,this.callPreview(),this.modal.hide()},handleTabClick:function(b){var c=a(b.target).closest("button"),d=this.$modal.find('.edy-bgpicker-tab[data-tab-id="'+c.data("tab-id")+'"]');this.$modal.find(".edy-tb-tabs button.edy-btn-blue").removeClass("edy-btn-blue").addClass("edy-btn-white"),c.removeClass("edy-btn-white").addClass("edy-btn-blue"),this.$modal.find(".edy-bgpicker-tab.active").removeClass("active"),c.add(d).addClass("active")},handleDrop:function(a,b){this.$el.removeClass("over"),"photo"===b.payload.type&&(this.backgroundImage=b.payload.url,this.handleBgImageChange())},handleDropenter:function(){this.$modal.addClass("edy-bgpicker-dropover")},handleDropleave:function(){this.$modal.removeClass("edy-bgpicker-dropover")}},Edicy.BgPicker=c}(Edicy.jQuery),function(a){"use strict";var b={positionable:!1,placeholder:'<div class="edy-img-drop-area-placeholder">Drag a new picture here from the files panel.</div>',removeBtn:'<div class="edy-img-drop-area-remove-image"></div>',onChange:function(){}},c=function(c,d){this.$el=a(c),this.options=a.extend({},b,d),this.init()};c.prototype={init:function(){this.$el.addClass("edy-img-drop-area"),this.image={url:this.$el.data("image")||null,width:this.$el.data("dimensions")?parseFloat(this.$el.data("dimensions").split(",")[0]):null,height:this.$el.data("dimensions")?parseFloat(this.$el.data("dimensions").split(",")[1]):null,top:this.$el.data("position")?parseFloat(this.$el.data("position").split(",")[0]):null,left:this.$el.data("position")?parseFloat(this.$el.data("position").split(",")[1]):null},this.fixPosition(),this.renderImage(),this.$el.on({"draggable:dragenter":a.proxy(this.handleDropenter,this),"draggable:dragleave":a.proxy(this.handleDropleave,this),"draggable:drop":a.proxy(this.handleDrop,this)}),this.options.positionable&&(this.$el.addClass("edy-img-drop-area-positionable"),this.$el.on("mousedown",a.proxy(this.handleMouseDown,this))),this.$el.on("click",".edy-img-drop-area-remove-image",a.proxy(this.handleDeleteClick,this))},renderImage:function(){this.image&&this.image.url?(this.$el.addClass("active"),this.$el.html(this.options.removeBtn),this.$el.css("background-image",'url("'+this.image.url+'")'),this.$el.css("background-position",this.image.left+"px "+this.image.top+"px")):(this.$el.css("background-image",""),this.$el.removeClass("active"),this.$el.html(this.options.placeholder))},handleDropenter:function(){this.$el.addClass("over")},handleDropleave:function(){this.$el.removeClass("over")},handleDrop:function(a,b){this.$el.removeClass("over"),"photo"===b.payload.type&&(this.image={url:b.payload.url,width:b.payload.width,height:b.payload.height,top:null,left:null},this.fixPosition(),this.renderImage(),this.handleImageChange())},handleDeleteClick:function(a){a.preventDefault(),this.image={url:"",width:null,height:null,top:null,left:null},this.renderImage(),this.handleImageChange()},handleImageChange:function(){this.options.change(this.image),this.$el.trigger("imagedrop",[this.image])},fixPosition:function(){this.image&&this.image.url&&(this.move_height=this.$el.width()/this.$el.height()>=this.image.width/this.image.height,this.curScale=this.move_height?this.$el.width()/this.image.width:this.$el.height()/this.image.height,this.cur_w=this.image.width*this.curScale,this.cur_h=this.image.height*this.curScale,this.min_pos=this.move_height?this.$el.height()-this.cur_h:this.$el.width()-this.cur_w,null===this.image.top&&(this.image.top=this.move_height?this.min_pos/2:0),null===this.image.left&&(this.image.left=this.move_height?0:this.min_pos/2),this.image.fixed_dimension=this.move_height?"width":"height")},handleMouseDown:function(b){this.image&&this.image.url&&(this.fixPosition(),this.mouse_start_x=b.pageX,this.mouse_start_y=b.pageY,a(document).on({"mousemove.imgdrop":a.proxy(this.handleMouseMove,this),"mouseup.imgdrop":a.proxy(this.handleMouseUp,this),"mouseleave.imgdrop":a.proxy(this.handleMouseUp,this)}))},handleMouseUp:function(b){this.move_height?this.image.top=Math.min(Math.max(this.image.top-(this.mouse_start_y-b.pageY),this.min_pos),0):this.image.left=Math.min(Math.max(this.image.left-(this.mouse_start_x-b.pageX),this.min_pos),0),a(document).off({"mousemove.imgdrop":this.handleMouseMove,"mouseup.imgdrop":this.handleMouseUp,"mouseleave.imgdrop":this.handleMouseUp}),this.handleImageChange()},handleMouseMove:function(a){var b;this.move_height?(b=Math.min(Math.max(this.image.top-(this.mouse_start_y-a.pageY),this.min_pos),0),this.$el.css("background-position","0 "+b+"px")):(b=Math.min(Math.max(this.image.left-(this.mouse_start_x-a.pageX),this.min_pos),0),this.$el.css("background-position",b+"px 0"))}},Edicy.ImgDropArea=c}(Edicy.jQuery,Edicy.Underscore);